<html><head><title>Homework5</title><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url('https://themes.googleusercontent.com/fonts/css?kit=lhDjYqiy3mZ0x6ROQEUoUw');ul.lst-kix_d1nebn2sv0br-7{list-style-type:none}ul.lst-kix_d1nebn2sv0br-6{list-style-type:none}ul.lst-kix_d1nebn2sv0br-8{list-style-type:none}.lst-kix_d1nebn2sv0br-4>li:before{content:"\0025cb  "}.lst-kix_d1nebn2sv0br-5>li:before{content:"\0025a0  "}.lst-kix_d1nebn2sv0br-2>li:before{content:"\0025a0  "}.lst-kix_d1nebn2sv0br-3>li:before{content:"\0025cf  "}.lst-kix_d1nebn2sv0br-6>li:before{content:"\0025cf  "}.lst-kix_d1nebn2sv0br-7>li:before{content:"\0025cb  "}.lst-kix_d1nebn2sv0br-0>li:before{content:"\0025cf  "}.lst-kix_d1nebn2sv0br-1>li:before{content:"\0025cb  "}.lst-kix_d1nebn2sv0br-8>li:before{content:"\0025a0  "}ul.lst-kix_d1nebn2sv0br-1{list-style-type:none}ul.lst-kix_d1nebn2sv0br-0{list-style-type:none}ul.lst-kix_d1nebn2sv0br-3{list-style-type:none}ul.lst-kix_d1nebn2sv0br-2{list-style-type:none}ul.lst-kix_d1nebn2sv0br-5{list-style-type:none}ul.lst-kix_d1nebn2sv0br-4{list-style-type:none}ol{margin:0;padding:0}.c0{margin-left:108pt;line-height:1.0;orphans:2;widows:2;direction:ltr;height:11pt}.c1{line-height:1.0;orphans:2;widows:2;direction:ltr;height:11pt}.c4{line-height:1.0;orphans:2;widows:2;direction:ltr}.c2{font-size:9pt;font-family:"Consolas";color:#0000ff}.c19{background-color:#ffffff;max-width:540pt;padding:36pt 36pt 36pt 36pt}.c18{orphans:2;widows:2;direction:ltr}.c15{margin-left:36pt;padding-left:0pt}.c11{padding:0;margin:0}.c9{font-size:9pt;font-family:"Courier New"}.c6{font-size:9pt;font-family:"Consolas"}.c3{font-size:10pt;font-weight:bold}.c17{margin-left:36pt}.c24{margin-left:72pt}.c22{margin-left:216pt}.c16{margin-left:108pt}.c21{height:11pt}.c12{text-decoration:underline}.c10{font-weight:bold}.c23{page-break-after:avoid}.c20{text-indent:36pt}.c13{font-style:italic}.c8{text-align:justify}.c7{color:#008000}.c5{font-size:10pt}.c14{font-family:"Consolas"}.title{padding-top:0pt;color:#000000;font-size:21pt;padding-bottom:0pt;font-family:"Trebuchet MS";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:13pt;padding-bottom:10pt;font-family:"Trebuchet MS";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:10pt;color:#000000;font-size:16pt;padding-bottom:0pt;font-family:"Trebuchet MS";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:10pt;color:#000000;font-weight:bold;font-size:13pt;padding-bottom:0pt;font-family:"Trebuchet MS";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:8pt;color:#666666;font-weight:bold;font-size:12pt;padding-bottom:0pt;font-family:"Trebuchet MS";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:8pt;color:#666666;text-decoration:underline;font-size:11pt;padding-bottom:0pt;font-family:"Trebuchet MS";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:8pt;color:#666666;font-size:11pt;padding-bottom:0pt;font-family:"Trebuchet MS";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:8pt;color:#666666;font-size:11pt;padding-bottom:0pt;font-family:"Trebuchet MS";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c19"><p class="c18"><span class="c10">CMPS 311 - Operating Systems</span></p><p class="c18"><span>Homework 5</span></p><p class="c1"><span></span></p><p class="c4"><span class="c5">For this assignment we will complete our dealing with Fibonacci numbers by implementing our own </span><span class="c3 c12">&ldquo;thread safe&rdquo; queue</span><span class="c5">.</span></p><p class="c1"><span class="c3"></span></p><ul class="c11 lst-kix_d1nebn2sv0br-0 start"><li class="c4 c15"><span class="c5">This is a C++ program.</span></li><li class="c4 c15"><span class="c5">The programming of this assignment is to be done</span><span class="c3">&nbsp;</span><span class="c3 c13">exclusively</span><span class="c3">&nbsp;on POSIX</span><span class="c5">. &nbsp;</span></li><li class="c4 c15"><span class="c5">You may </span><span class="c3">not use C++ synchronization objects</span><span class="c5">, you must use the POSIX implementations. &nbsp;</span></li><li class="c4 c15"><span class="c5">You </span><span class="c3">may</span><span class="c5">, however, use C++ x11 threads instead of pthreads if you wish - </span><span class="c3 c12">that&rsquo;s up to you</span><span class="c5">.</span></li><li class="c4 c15"><span class="c5">You may implement your queue in any reasonable way (linked list, array, etc) - although you </span><span class="c3 c12">may </span><span class="c3 c12 c13">not</span><span class="c3 c12">&nbsp;</span><span class="c5">use any STL or other library implementations of queues (i.e. no </span><span class="c3 c14">vector</span><span class="c5">, no </span><span class="c3 c14">queue</span><span class="c5">&nbsp;- do it on your own).</span></li></ul><p class="c1"><span class="c3"></span></p><p class="c4"><span class="c5">As your first task, implement a </span><span class="c3">class</span><span class="c5">&nbsp;called SafeQueue in C++ that serves as a FIFO queue with the following functions:</span></p><p class="c1"><span class="c5"></span></p><p class="c4"><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c2">class</span><span class="c6">&nbsp;SafeQueue {</span></p><p class="c4 c17"><span class="c6">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c2">public</span><span class="c6">:</span></p><p class="c4 c17"><span class="c6">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c6 c7">// return false if the queue contains</span></p><p class="c4 c17"><span class="c6 c7">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// data, true if empty. Should return </span><span class="c6 c13 c7">immediately</span><span class="c6 c7">.</span></p><p class="c4 c16"><span class="c2">bool</span><span class="c6">&nbsp;isEmpty() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p><p class="c1 c22"><span class="c6 c7"></span></p><p class="c0"><span class="c6 c7"></span></p><p class="c4 c16"><span class="c6 c7">// Puts the double at the &ldquo;front&rdquo; of the queue into &ldquo;value&rdquo;</span></p><p class="c4 c16"><span class="c6 c7">// If the queue is currently empty (see discussion below), </span></p><p class="c4 c16"><span class="c6 c7">// this function should BLOCK.</span></p><p class="c4 c16"><span class="c2">void</span><span class="c6">&nbsp;read(double &amp; value) </span></p><p class="c0"><span class="c6 c7"></span></p><p class="c0"><span class="c6 c7"></span></p><p class="c4 c16"><span class="c6 c7">// Puts &ldquo;value&rdquo; at the back of the queue. </span></p><p class="c4 c16"><span class="c6 c7">// Returns false if anything goes wrong (full queue?)</span></p><p class="c4 c16"><span class="c6 c7">// Returns true if all goes smoothly.</span></p><p class="c4 c16"><span class="c2">int</span><span class="c6">&nbsp;write(double value) </span><span class="c6">;</span></p><p class="c4 c24"><span class="c2">private</span><span class="c6">: &hellip;</span></p><p class="c4 c20"><span class="c6">};</span></p><p class="c1"><span class="c9"></span></p><p class="c4 c8"><span class="c5">Y</span><span class="c5">our class should be a </span><span class="c3 c13">monitor,</span><span class="c13 c5">&nbsp;</span><span class="c5">so two threads may read and write to the queue w/o race conditions. To do this, you need to include a </span><span class="c3 c12">private mutex variable</span><span class="c5">&nbsp;and acquire the lock (enter the critical section) </span><span class="c3">within</span><span class="c5">&nbsp;the read and write methods/functions. Be careful &ndash; race conditions and synchronization errors may not always cause visible inconsistencies &ndash; this does not mean that the </span><span class="c13 c5">possibility</span><span class="c5">&nbsp;for error does not exist. </span></p><p class="c1 c8"><span class="c5"></span></p><p class="c4"><span class="c5">Your read function should block if the queue is empty. &nbsp;This will require you to utilize a semaphore (in addition to the mutex) to keep count of the number of items in your queue. &nbsp;Thus, the read function may efficiently wait (block) until the semaphore is signaled (S&gt;0) before it attempts to enter its critical section and read the first value on the queue. &nbsp;Similarly, your write function will need to increment the Semaphore</span></p><p class="c1"><span class="c5"></span></p><p class="c4"><span class="c5">Your read method should follow this general structure:</span></p><p class="c1"><span class="c5"></span></p><p class="c4"><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5 c14">Wait until Semaphore is &gt; 0</span></p><p class="c4"><span class="c5 c14">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Decrement Semaphore</span></p><p class="c4"><span class="c5 c14">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Enter Critical Section</span></p><p class="c4"><span class="c5 c14">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Read value and remove from queue</span></p><p class="c4"><span class="c5 c14">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Leave Critical Section</span></p><p class="c1"><span class="c5 c14"></span></p><p class="c4"><span class="c5">Your write Function should do the following:</span></p><p class="c1"><span class="c5"></span></p><p class="c4"><span class="c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5 c14">Enter Critical Section</span></p><p class="c4"><span class="c5 c14">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Add value to back of queue</span></p><p class="c4"><span class="c5 c14">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Increment Semaphore</span></p><p class="c4"><span class="c5 c14">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Leave Critical Section</span></p><p class="c1 c8"><span class="c5"></span></p><p class="c4 c8"><span class="c3">Tip:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="c5">Check out your textbook - particularly 2.3.5 on &ldquo;Solving the Producer Consumer Problem&rdquo;</span></p><p class="c1 c8"><span class="c5"></span></p><h1 class="c4 c23"><a name="h.qlurxnjm43a3"></a><span>Main Program</span></h1><p class="c4"><span class="c5">Implement problem #1 from Homework #2, this time with threads </span><span class="c12 c5">instead of processes</span><span class="c5">&nbsp;and your SafeQueue class </span><span class="c12 c5">instead of pipes</span><span class="c5">. </span></p><p class="c1"><span class="c3"></span></p><p class="c4"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 606.00px; height: 263.00px;"><img alt="" src="images/image00.png" style="width: 606.00px; height: 263.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c1"><span class="c3"></span></p><p class="c4"><span class="c5">Your main thread should ask the user for an &ldquo;n&rdquo; value. It will need to create a SafeQueue and then create the calculation and printing thread. The calculation thread will compute the first &ldquo;n&rdquo; Fibonacci numbers, sending each one </span><span class="c13 c5">individually</span><span class="c5">&nbsp;to the printing thread via the SafeQueue. The printing thread will read each number from the queue and write them to fib-n.txt. </span><span class="c5 c13">&nbsp;</span><span class="c5">The following pseudo code outlines the calculation and printing threads:</span></p><p class="c1"><span class="c5"></span></p><p class="c4"><span class="c9 c10">Calculation Thread:</span></p><p class="c1"><span class="c9 c10"></span></p><p class="c4"><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for ( each Fibonacci number up to &ldquo;n&rdquo; numbers)</span></p><p class="c4"><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;safeQueue-&gt;write (fibonnaci number);</span></p><p class="c1"><span class="c9"></span></p><p class="c4"><span class="c9 c10">Printing Thread:</span></p><p class="c1"><span class="c9 c10"></span></p><p class="c4"><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Open File</span></p><p class="c4"><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;For ( each Fibonnaci number up to &ldquo;n&rdquo; numbers)</span></p><p class="c4"><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;safeQueue-&gt;read(num);</span></p><p class="c4"><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;write num to file</span></p><p class="c4"><span class="c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Close file</span></p><p class="c1"><span class="c9"></span></p><p class="c1"><span class="c9"></span></p><p class="c1"><span class="c9"></span></p><p class="c1"><span class="c9"></span></p><p class="c1"><span class="c3 c13"></span></p><p class="c1 c8"><span class="c3 c13"></span></p><p class="c1"><span class="c3 c13"></span></p><p class="c1"><span class="c3 c13"></span></p><p class="c18 c21"><span></span></p></body></html>